<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.yueguang.dao.UserDao">

    <sql id="selectUserListWhere">
        <where>
            u.roleId = r.roleId
            <if test="keywords!=null and keywords!=''">
                AND (u.userName LIKE CONCAT('%',#{keywords},'%') OR u.loginName LIKE CONCAT('%',#{keywords},'%'))
            </if>
            <if test="userListRoledId!=null and userListRoledId!=''">
                AND (u.roleId=#{userListRoledId})
            </if>
        </where>
    </sql>

    <select id="selectUserList" parameterType="String" resultType="User">
        SELECT u.*,r.roleName FROM t_user AS u,t_role AS r
        <include refid="selectUserListWhere"/>
        ORDER BY registerTime DESC
    </select>

    <select id="findUser" parameterType="String" resultType="User">
        SELECT * FROM t_user WHERE loginName=#{loginName} AND password=#{password} limit 0,1
    </select>

    <select id="findUserById" parameterType="Integer" resultType="user">
        SELECT * FROM t_user WHERE id=#{id}
    </select>

    <select id="getUserLoginName" parameterType="String" resultType="User">
        SELECT * FROM t_user WHERE loginName=#{loginName}  limit 0,1
    </select>

    <insert id="addUser" parameterType="User">
        INSERT INTO `new_system`.`t_user` (
            `userName`,
            `loginName`,
            `password`,
            `tel`,
            `registerTime`,
            `status`,
             `roleId`,
        )
        VALUES
            (
              #{userName},
              #{loginName},
              #{password},
              #{tel},
              #{registerTime},
              #{status},
              #{roleId},
            );

    </insert>
    <update id="updateUser" parameterType="User">
        UPDATE t_user
        <set>
            registerTime=#{registerTime},
            status=#{status},
            <if test="userName!=null and userName!=''">
                userName=#{userName},
            </if>
            <if test="password!=null and password!=''">
                password=#{password},
            </if>
            <if test="tel!=null and tel!=''">
                tel=#{tel},
            </if>
            <if test="roleId!=null and roleId!=''">
                roleId=#{roleId},
            </if>
        </set>
        WHERE userId=#{userId}
    </update>
    <delete id="delUser" parameterType="Integer">
        DELETE  FROM t_user WHERE userId=#{userId}
    </delete>

    <update id="setUserStatus" parameterType="User">
        UPDATE t_user SET status=#{status} WHERE userId=#{userId}
    </update>
</mapper>